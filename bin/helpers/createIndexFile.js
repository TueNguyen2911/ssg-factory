const path = require("path");
const { ConvertToHtml } = require("./convertToHtml");
const { WriteHtml } = require("./writeHtml");
/**
 * CreateIndexFile generates an index file to link all files generated by SSG
 */
class CreateIndexFile {
  constructor(generatedFiles, lang, outputFolder) {
    this.generatedFiles_ = generatedFiles;
    this.lang_ = lang;
    this.outputFolder_ = outputFolder;
  }
  /**
   * Generate index.html to output folder
   * @returns a Promise resolve message
   */
  createIndexHtmlFile = () => {
    return new Promise((resolve) => {
      const convertToHtml = new ConvertToHtml(this.lang_, this.outputPath_);

      const links = this.generatedFiles_
        .map((param, index) => {
          let line = `<a style="display:block" href=${path
            .basename(param)
            .replace(/\s/g, "%20")}>${path.basename(param, ".html")}</a>\n`;
          if (index == 0) {
            line = `<h1>Index</h1>\n<a style="display:block" href=${path
              .basename(param)
              .replace(/\s/g, "%20")}>${path.basename(param, ".html")}</a>\n`;
          }
          return line;
        })
        .join("");

      const htmlString = convertToHtml.interpolateHtml(links, "Index");
      const writeHtmlFile = new WriteHtml(
        path.join(this.outputFolder_, "Index.html"),
        htmlString
      );
      (async () => {
        await writeHtmlFile.writeHtmlFileToOutputFolder();
        resolve(`${path.join(this.outputFolder_, "Index.html")} is created`);
      })();
    });
  };
}

module.exports.CreateIndexFile = CreateIndexFile;
